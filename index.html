<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/128/14887/14887212.png">
    <title>TURNO ETERNO</title>
    <!-- Filtro SVG para distorsión de texto -->
    <svg width="0" height="0" style="position:absolute">
        <filter id="wavy-text">
            <feTurbulence baseFrequency="0.005 0.005" numOctaves="2" seed="2" type="turbulence" result="turb" />
            <feDisplacementMap in2="turb" in="SourceGraphic" scale="10" xChannelSelector="R" yChannelSelector="G" />
        </filter>
    </svg>
    <!-- Google Fonts medievales -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=UnifrakturCook:wght@700&display=swap"
        rel="stylesheet">
    <style>
        /* Fondo galaxial parallax */
        body {
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            font-family: 'Cinzel', 'UnifrakturCook', serif, Arial, sans-serif;
            color: #fff;
            /* background: #0a0026; */
            background: linear-gradient(180deg, #0a0026 0%, #0a0026 100%);
            transition: all 0.8s cubic-bezier(.4, 0, .2, 1);
        }

        .parallax-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -3;
            overflow: hidden;
            transition: opacity 0.8s cubic-bezier(.4, 0, .2, 1);
        }

        .stars,
        .stars2,
        .stars3,
        .nebulosa {
            position: absolute;
            width: 100vw;
            height: 100vh;
            background-repeat: repeat;
            background-size: cover;
            pointer-events: none;
            transition: opacity 0.8s cubic-bezier(.4, 0, .2, 1);
        }

        .stars {
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
            opacity: 0.7;
            animation: moveStars 120s linear infinite;
            z-index: -3;
        }

        .stars2 {
            background-image: url('https://www.transparenttextures.com/patterns/tiny-grid.png');
            opacity: 0.3;
            animation: moveStars2 200s linear infinite;
            z-index: -2;
        }

        .stars3 {
            background-image: url('https://www.transparenttextures.com/patterns/diamond-upholstery.png');
            opacity: 0.2;
            animation: moveStars3 300s linear infinite;
            z-index: -1;
        }

        @keyframes moveStars {
            from {
                background-position: 0 0;
            }

            to {
                background-position: 1000px 1000px;
            }
        }

        @keyframes moveStars2 {
            from {
                background-position: 0 0;
            }

            to {
                background-position: -1000px 500px;
            }
        }

        @keyframes moveStars3 {
            from {
                background-position: 0 0;
            }

            to {
                background-position: 500px -1000px;
            }
        }

        /* Nebulosa */
        .nebulosa {
            position: absolute;
            top: 10vh;
            left: 50vw;
            width: 60vw;
            height: 60vh;
            background: radial-gradient(ellipse at center, rgba(120, 0, 255, 0.3) 0%, rgba(0, 0, 0, 0) 80%);
            filter: blur(40px);
            z-index: -1;
            animation: nebulaMove 40s ease-in-out infinite alternate;
        }

        @keyframes nebulaMove {
            0% {
                transform: translate(-30vw, 0);
            }

            100% {
                transform: translate(10vw, 10vh);
            }
        }

        /* Título épico */
        .titulo {
            font-size: 3.5em;
            text-align: center;
            letter-spacing: 0.1em;
            font-family: 'UnifrakturCook', 'Cinzel', serif, Arial, sans-serif;
            color: #fff;
            text-shadow: 0 0 30px #7f00ff, 0 0 10px #00c3ff, 2px 2px 8px #000;
            filter: url(#wavy-text);
            background: linear-gradient(90deg, #7f00ff 0%, #e100ff 50%, #00c3ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Contenido épico */
        .contenido {
            max-width: 700px;
            margin: 3em 1em 2em 1em;
            padding: 2em 2em 2em 2em;
            background: rgba(20, 0, 40, 0.7);
            border-radius: 20px;
            box-shadow: 0 0 40px 10px #7f00ff55;
            font-size: 1.25em;
            line-height: 1.7;
            backdrop-filter: blur(2px);
            transition: box-shadow 0.8s cubic-bezier(.4, 0, .2, 1);
            margin-left: auto;
            margin-right: auto;
        }

        .contenido h2 {
            text-align: center;
            font-size: 3em;
            font-family: 'Cinzel', 'UnifrakturCook', serif, Arial, sans-serif;
        }

        .contenido strong {
            color: #00c3ff;
            text-shadow: 0 0 8px #fff, 0 0 4px #7f00ff;
        }

        /* Primera letra grande en nombres de guardianes */
        .contenido h3::first-letter {
            font-size: 2em;
            color: #00c3ff;
            text-shadow: 0 0 10px #7f00ff, 0 0 4px #fff;
            font-weight: bold;
        }

        .caidos-section {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 18px;
            box-shadow: 0 0 40px 10px #000a, 0 0 0 4px #222 inset;
            margin-top: 3em;
            padding: 2em 1.5em 1.5em 1.5em;
            position: relative;
            transition: background 1s;
        }

        .caidos-section h2 {
            color: #bdbdbd;
            text-shadow: 0 0 18px #000, 0 0 4px #fff2;
            letter-spacing: 0.15em;
            font-family: 'Cinzel', serif;
        }

        .caidos-section h3 {
            color: #6e6e6e;
            text-shadow: 0 0 10px #000, 0 0 2px #fff2;
        }

        .caidos-section p {
            color: #bdbdbd;
            font-style: italic;
            text-shadow: 0 0 8px #000;
        }

        .caidos-section::before {
            content: "";
            display: block;
            position: absolute;
            left: 50%;
            top: -30px;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background: url('https://cdn-icons-png.flaticon.com/128/2917/2917242.png') no-repeat center/contain;
            opacity: 0.25;
            filter: grayscale(1);
        }

        /* Fondo fúnebre al llegar a Los Caídos */
        body.funebre {
            background: linear-gradient(180deg, #181818 0%, #232323 100%) !important;
            transition: all 0.8s cubic-bezier(.4, 0, .2, 1);
        }

        .parallax-bg.funebre .stars,
        .parallax-bg.funebre .stars2,
        .parallax-bg.funebre .stars3,
        .parallax-bg.funebre .nebulosa {
            opacity: 0.08 !important;
        }

        body.funebre .contenido {
            box-shadow: 0 0 40px 10px #000a;
            background: rgba(24, 24, 24, 0.7);
        }

        body.funebre .contenido h3::first-letter {
            color: #191919;
            text-shadow: 0 0 10px #ffffff, 0 0 4px #fff;
        }

        /* Botón para abrir listado de días */
        .dias-toggle {
            text-align: center;
            margin-top: 0.6rem;
        }

        .dias-toggle button {
            background: linear-gradient(90deg, #7f00ff, #00c3ff);
            border: none;
            color: white;
            padding: 0.45rem 0.9rem;
            border-radius: 999px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(127, 0, 255, 0.18);
            transition: transform .15s ease, box-shadow .15s ease;
        }

        .dias-toggle button:active {
            transform: translateY(1px);
        }

        /* Panel lateral / modal para mostrar días */
        .dias-panel {
            position: fixed;
            right: 1.5rem;
            top: 4rem;
            bottom: 2rem;
            width: min(720px, 95vw);
            background: rgba(10, 6, 20, 0.95);
            backdrop-filter: blur(6px);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            padding-left: 1rem;
            padding-right: 1rem;
            padding-bottom: 1rem;
            overflow: auto;
            z-index: 9999;
            display: none;
        }

        .dias-panel.open {
            display: block;
        }

        .dias-panel .panel-header {
            /* hacer la cabecera fija dentro del panel para que el botón Cerrar siempre sea accesible */
            position: sticky;
            top: 0;
            z-index: 50;
            display: flex;
            gap: .5rem;
            align-items: center;
            justify-content: space-between;
            margin-bottom: .8rem;
            padding: .75rem 0.8rem;
            background: linear-gradient(180deg, rgba(10,6,20,0.95), rgba(10,6,20,0.85));
            backdrop-filter: blur(6px);
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .dias-panel .panel-controls {
            display: flex;
            gap: .5rem;
            align-items: center;
        }

        .dias-panel input[type="search"] {
            min-width: 220px;
            padding: .45rem .6rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: rgba(255, 255, 255, 0.02);
            color: #fff;
            outline: none;
        }

        .dias-grid {
            display: grid;
            /* una sola columna para que las frases no queden en columnas */
            grid-template-columns: 1fr;
            gap: .8rem;
        }

        .dia-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border-radius: 10px;
            padding: .8rem;
            color: #e6e6e6;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.6);
            font-size: .95rem;
            display: flex;
            flex-direction: column;
            gap: .5rem;
            max-height: 240px;
            overflow: hidden;
            position: relative;
        }

        .dia-card .day-num {
            font-weight: 800;
            color: #00c3ff;
            letter-spacing: .06em;
            font-size: .95rem;
        }

        .dia-card .dia-snippet {
            flex: 1 1 auto;
            overflow: auto;
            /* evitar columnas y respetar el flujo normal de texto */
            white-space: normal;
            line-height: 1.4;
            color: #ddd;
            /* asegurar que no se use multicolumn layout */
            column-count: 1;

            /* padding para separar texto del thumb */
            padding-right: 8px;
        }

        /* WebKit (Chrome, Edge, Safari) */
        .dia-card .dia-snippet::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .dia-card .dia-snippet::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.4);
        }

        .dia-card .dia-snippet::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #7f00ff, #00c3ff);
            border-radius: 10px;
            border: 2px solid rgba(0, 0, 0, 0.25);
            min-height: 24px;
        }

        .dia-card .dia-snippet::-webkit-scrollbar-thumb:hover {
            filter: brightness(1.08);
        }

        /* WebKit (Chrome, Edge, Safari) */
        .dias-panel::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .dias-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.4);
        }

        .dias-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #7f00ff, #00c3ff);
            border-radius: 10px;
            border: 2px solid rgba(0, 0, 0, 0.25);
            min-height: 24px;
        }

        .dias-panel::-webkit-scrollbar-thumb:hover {
            filter: brightness(1.08);
        }

        .dia-card .more {
            margin-top: .4rem;
            align-self: flex-end;
            background: transparent;
            border: none;
            color: #7f00ff;
            cursor: pointer;
            font-weight: 700;
        }

        /* estado expandido */
        .dia-card.expanded {
            max-height: none;
        }

        .dia-card.expanded .dia-snippet {
            max-height: none;
        }

        /* Close button */
        .dias-close {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: #fff;
            padding: .35rem .6rem;
            border-radius: 8px;
            cursor: pointer;
        }

        @media (max-width: 800px) {
            .dias-panel {
                left: 1rem;
                right: 1rem;
                top: 3.5rem;
                bottom: 1rem;
                width: auto;
            }

            .dias-grid {
                display: grid;
                /* una sola columna para que las frases no queden en columnas */
                grid-template-columns: 1fr;
                gap: .8rem;
            }
        }

        @media (max-width: 600px) {
            .titulo {
                font-size: 1.5em;
                margin-top: 1.2em;
                padding: 0 0.3em;
            }

            .contenido {
                max-width: 98vw;
                padding: 1em 1em 1em 1em;
                font-size: 1em;
                border-radius: 12px;
            }

            .contenido h2 {
                font-size: 2em;
            }

            .caidos-section {
                padding: 1.2em 0.5em 1em 0.5em;
                margin-top: 2em;
                border-radius: 10px;
            }

            .caidos-section h2 {
                font-size: 1.5em;
            }

            .caidos-section::before {
                width: 38px;
                height: 38px;
                top: -18px;
            }

            .parallax-bg,
            .stars,
            .stars2,
            .stars3,
            .nebulosa {
                width: 100vw !important;
                height: 100vh !important;
                min-width: 100vw !important;
                min-height: 100vh !important;
            }

            section>h3 {
                font-size: 1.1em;
            }

            .contenido p,
            .caidos-section p {
                font-size: 0.98em;
            }
        }
    </style>
</head>

<body>
    <!-- Fondo galaxial parallax -->
    <div class="parallax-bg">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
        <div class="nebulosa"></div>
    </div>

    <!-- Título -->
    <h1 class="titulo">La Leyenda de Los Eternos</h1>

    <!-- Nuevo: botón para abrir listado de días -->
    <div class="dias-toggle" aria-hidden="false">
        <button id="open-dias" type="button" aria-expanded="false">Diario de los eternos</button>
    </div>

    <div class="contenido">
        <section>
            <h2>El Reino</h2>
            <p>
                En los oscuros pasillos del Reino, donde el tiempo se dobla y los correos nunca descansan, existe
                un mítico equipo, <strong>Los Eternos</strong>. Allí, los relojes no mandan, los tickets se regeneran y
                solo los elegidos sobreviven sin perder la cordura (del todo).
            </p>
            <p>
                Entre estos guardianes, se forjaron leyendas. Cada uno, con su propio don, mantiene el equilibrio en el
                universo.
            </p>
        </section>

        <section>
            <h2>LOS GUARDIANES</h2>

            <section>
                <h3>Yago, el Fantasías</h3>
                <p>
                    Espíritu libre atrapado en un cuerpo de empleado. Maestro del multitasking legendario y portador de
                    ideas imposibles. Algunos dicen que ya resolvió los tickets del mes siguiente... otros aseguran que
                    solo estaba viendo videos motivacionales. Su creatividad es tan infinita como su capacidad para
                    despistar a los supervisores.
                </p>
            </section>

            <section>
                <h3>Ellande, el Anciano</h3>
                <p>
                    El sabio del escuadrón. Ha vivido tantas actualizaciones que recuerda cuando los tickets eran en
                    papel y los correos se enviaban por paloma mensajera. Conoce atajos olvidados por el tiempo y su
                    presencia impone respeto. Habla poco, pero cuando lo hace, el pueblo escucha y los peones tiemblan.
                </p>
            </section>

            <section>
                <h3>Ivan, el Chamán</h3>
                <p>
                    El místico del grupo. Conoce los secretos más oscuros del reino y puede comunicarse con los tickets
                    perdidos en el limbo digital. Su sabiduría es legendaria, y se dice que puede predecir los picos de
                    carga antes de que ocurran. Siempre tiene un ritual para cada incidencia y un conjuro para cada
                    usuario.
                </p>
            </section>

            <section>
                <h3>Dani, el Increíble</h3>
                <p>
                    Una fuerza imparable con el teclado. Soluciona errores antes de que se reporten, responde correos
                    con la mente y resuelve conflictos de usuarios con un solo mensaje. Si hay una emergencia, Dani ya
                    la resolvió. Si no la ves trabajando, es porque va más rápido que la vista. Su leyenda dice que
                    nunca ha perdido una batalla contra el reloj.
                </p>
            </section>

            <section>
                <h3>Cristian, el Otorgador de Vida</h3>
                <p>
                    El generoso del grupo. Siempre dispuesto a ayudar, comparte su conocimiento y recursos con todos. Se
                    dice que puede revivir a cualquier caído con solo un par de clics. Su lema: "Un ticket resuelto es
                    un usuario feliz". Donde hay caos, él siembra orden y esperanza.
                </p>
            </section>

            <section>
                <h3>Diego, el Inocente</h3>
                <p>
                    El más puro del grupo. Siempre ve lo mejor en los demás y nunca duda de las intenciones de sus
                    compañeros. Su optimismo es contagioso, y se dice que puede resolver conflictos simplemente
                    sonriendo. Nadie que lo haya visto triste ha vivido para contarlo.
                </p>
            </section>

            <section>
                <h3>Unai, el Tanque</h3>
                <p>
                    El protector del grupo. Siempre está dispuesto a recibir el impacto de los problemas y a defender a
                    sus compañeros. Su resistencia es legendaria, y se dice que puede soportar cualquier carga sin
                    inmutarse. Cuando todo parece perdido, Unai aguanta firme y nunca deja caer a los suyos.
                </p>
            </section>

            <section>
                <h3>Gorka, el Gigante</h3>
                <p>
                    Coloso entre los Eternos, su presencia impone respeto y confianza. Gorka es la fuerza tranquila:
                    resuelve los desafíos más grandes con una sonrisa y siempre tiene una palabra de ánimo para el
                    equipo. Cuando todo parece imposible, él demuestra que ningún obstáculo es demasiado grande.
                </p>
            </section>
        </section>

        <section>
            <h2>El Legado</h2>
            <p>
                Así, día tras noche y ticket tras ticket, estos héroes mantienen viva la leyenda.
                Porque cuando todos descansan... Los Eternos vigilan.
            </p>
        </section>

        <!-- Nueva sección para los caídos -->
        <section class="caidos-section" id="caidos">
            <h2>Los Caídos</h2>
            <section>
                <h3>Kristian, el Nocturno</h3>
                <p>
                    Dueño de la noche y amo de los silencios del reino. Mientras todos duermen, él vigila con su café
                    eterno y mirada de guerra. K enfrentaba los bugs como un monje guerrero, resolviendo incidencias
                    imposibles en la penumbra. Nadie dominaba la oscuridad como él, y su legado aún resuena en cada
                    guardia nocturna.
                </p>
            </section>
            <section>
                <h3>Bruno, el Hermoso</h3>
                <p>
                    Su sola presencia iluminaba el Reino, capaz de calmar hasta los tickets más rebeldes. Maestro en el
                    arte de la elegancia bajo presión, Bruno resolvía problemas sin despeinarse y dejaba tras de sí un
                    aura de buen rollo y admiración. Dicen que aún se siente su encanto en cada rincón del Reino.
                </p>
            </section>
        </section>
    </div>

    <!-- Panel de días (se rellena desde JS) -->
    <aside id="dias-panel" class="dias-panel" role="dialog" aria-modal="false" aria-labelledby="dias-title">
        <div class="panel-header">
            <h3 id="dias-title" style="margin:0;color:#fff">Días — Cronología</h3>
            <div class="panel-controls">
                <input id="dias-search" type="search" placeholder="Buscar texto o número de día..."
                    aria-label="Buscar días">
                <button id="close-dias" class="dias-close" type="button">Cerrar</button>
            </div>
        </div>
        <div id="dias-grid" class="dias-grid" aria-live="polite">
            <!-- tarjetas inyectadas -->
        </div>
        <div id="dias-empty" style="display:none;color:#bbb;margin-top:.6rem">No se encontraron entradas.</div>
    </aside>
</body>

<script>
    // Transición suave al entrar/salir de la sección de Los Caídos
    document.addEventListener('DOMContentLoaded', function () {
        const caidos = document.getElementById('caidos');
        const parallax = document.querySelector('.parallax-bg');
        let funebreActive = false;

        function setFunebre(active) {
            if (active === funebreActive) return;
            funebreActive = active;
            if (active) {
                document.body.classList.add('funebre');
                if (parallax) parallax.classList.add('funebre');
            } else {
                document.body.classList.remove('funebre');
                if (parallax) parallax.classList.remove('funebre');
            }
        }

        function checkCaidosInView() {
            const rect = caidos.getBoundingClientRect();
            const windowHeight = window.innerHeight || document.documentElement.clientHeight;
            // Calcula la parte visible de la sección
            const visibleHeight = Math.min(rect.bottom, windowHeight) - Math.max(rect.top, 0);
            const visibleRatio = visibleHeight / rect.height;
            // Solo activa el modo fúnebre si al menos el 30% de la sección es visible
            const inView = visibleRatio > 0.3;
            setFunebre(inView);
        }
        window.addEventListener('scroll', checkCaidosInView);
        checkCaidosInView();

        // --- PARALLAX SCROLL FONDO ---
        const stars = document.querySelector('.stars');
        const stars2 = document.querySelector('.stars2');
        const stars3 = document.querySelector('.stars3');
        const nebulosa = document.querySelector('.nebulosa');

        window.addEventListener('scroll', function () {
            const scrollY = window.scrollY;
            if (stars) stars.style.backgroundPosition = `0px ${scrollY * 0.3}px`;
            if (stars2) stars2.style.backgroundPosition = `0px ${scrollY * 0.15}px`;
            if (stars3) stars3.style.backgroundPosition = `0px ${scrollY * 0.07}px`;
            if (nebulosa) nebulosa.style.top = `${10 + scrollY * 0.05}vh`;
        });
    });

    /* ======= NUEVO: carga y render de dias.json (remote con fallback) ======= */
    (function () {
        const remoteCandidates = [
            "https://raw.githubusercontent.com/elturnoeternojamascaera/24-7/main/dias.json",
            "https://raw.githubusercontent.com/elturnoeternojamascaera/24_7/main/dias.json",
            "https://raw.githubusercontent.com/elturnoeterno/247/main/dias.json"
        ];
        const localFallback = "./dias.json";

        async function fetchWithTimeout(url, timeout = 6000) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            try {
                const res = await fetch(url, { signal: controller.signal });
                clearTimeout(id);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return res;
            } catch (e) {
                clearTimeout(id);
                throw e;
            }
        }

        async function loadDias() {
            // Intenta los candidatos remotos en orden, si fallan usa local
            for (const u of remoteCandidates) {
                try {
                    const r = await fetchWithTimeout(u, 7000);
                    const data = await r.json();
                    return data;
                } catch (err) {
                    // continúa con siguiente candidato
                }
            }
            // fallback local
            try {
                const r = await fetchWithTimeout(localFallback, 4000);
                return await r.json();
            } catch (err) {
                console.error("No se pudo cargar dias.json (remote ni local).", err);
                return [];
            }
        }

        function createCard(entry) {
            const card = document.createElement('article');
            card.className = 'dia-card';
            card.dataset.day = entry.day;
            const head = document.createElement('div');
            head.className = 'day-num';
            head.textContent = `Día ${entry.day}`;

            const snippet = document.createElement('div');
            snippet.className = 'dia-snippet';

            const raw = entry.content || '';
            if (raw.includes('[INTRO]')) {
                // Divide por cada marcador y procesa en orden:
                // - el primer segmento es texto previo (antes del primer [INTRO])
                // - cada segmento posterior genera una intro-line con la primera línea,
                //   y el resto del segmento se añade como texto normal.
                const parts = raw.split('[INTRO]');
                const before = parts[0].trim();
                if (before) {
                    const beforeEl = document.createElement('div');
                    beforeEl.textContent = before;
                    snippet.appendChild(beforeEl);
                    // dos saltos de línea explícitos
                }

                for (let i = 1; i < parts.length; i++) {
                    const part = parts[i];
                    const [introLine, ...restLines] = part.split(/\r?\n/);
                    if (introLine && introLine.trim()) {
                        const introEl = document.createElement('div');
                        introEl.className = 'intro-line';
                        introEl.textContent = introLine.trim();
                        snippet.appendChild(introEl);
                        // dos saltos de línea tras la intro
                    }
                    const restText = restLines.join('\n').trim();
                    if (restText) {
                        const restEl = document.createElement('div');
                        restEl.textContent = restText;
                        snippet.appendChild(restEl);
                        // si hay más partes, separar con dos saltos
                    }
                }
            } else {
                snippet.textContent = raw;
            }

            const moreBtn = document.createElement('button');
            moreBtn.className = 'more';
            moreBtn.type = 'button';
            moreBtn.textContent = 'Leer más';
            moreBtn.addEventListener('click', () => {
                card.classList.toggle('expanded');
                moreBtn.textContent = card.classList.contains('expanded') ? 'Leer menos' : 'Leer más';
                if (card.classList.contains('expanded')) card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
            card.appendChild(head);
            card.appendChild(snippet);
            card.appendChild(moreBtn);
            return card;
        }

        function renderGrid(list) {
            const grid = document.getElementById('dias-grid');
            const empty = document.getElementById('dias-empty');
            grid.innerHTML = '';
            if (!Array.isArray(list) || list.length === 0) {
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            list.forEach(item => {
                grid.appendChild(createCard(item));
            });
        }

        function filterAndRender(allEntries, query) {
            if (!query) {
                renderGrid(allEntries);
                return;
            }
            const q = query.trim().toLowerCase();
            const filtered = allEntries.filter(e => {
                return String(e.day).includes(q) || (e.content || '').toLowerCase().includes(q);
            });
            renderGrid(filtered);
        }

        // UI wiring
        document.addEventListener('DOMContentLoaded', async () => {
            const openBtn = document.getElementById('open-dias');
            const closeBtn = document.getElementById('close-dias');
            const panel = document.getElementById('dias-panel');
            const search = document.getElementById('dias-search');

            let allDias = [];

            openBtn.addEventListener('click', () => {
                const isOpen = panel.classList.toggle('open');
                openBtn.setAttribute('aria-expanded', String(isOpen));
                panel.setAttribute('aria-modal', String(isOpen));
                if (isOpen) {
                    // si aún no cargado, cargar
                    if (!allDias.length) {
                        loadDias().then(data => {
                            allDias = Array.isArray(data) ? data : [];
                            // aseguramos orden por día
                            allDias.sort((a, b) => (a.day || 0) - (b.day || 0));
                            renderGrid(allDias);
                        }).catch(err => {
                            console.error(err);
                            document.getElementById('dias-empty').textContent = 'Error cargando entradas.';
                            document.getElementById('dias-empty').style.display = 'block';
                        });
                    }
                }
            });
            closeBtn.addEventListener('click', () => {
                panel.classList.remove('open');
                openBtn.setAttribute('aria-expanded', 'false');
                panel.setAttribute('aria-modal', 'false');
            });
            search.addEventListener('input', (e) => {
                filterAndRender(allDias, e.target.value);
            });
        });
    })();
</script>

</html>